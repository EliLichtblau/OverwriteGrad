All of the interesting code here is taken from: https://github.com/ClashLuke/TrueGrad. This repo exists to be able to play with square grad without having to deal with some of the complexities of that code.